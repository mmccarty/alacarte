.book{:id => "book_#{book.id}"}
  = error_messages_for "book"
  - if flash[:error]
    #error_wrapper
      #list_error= flash[:error]
  - new_or_existing = book.new_record? ? 'new' : 'existing'
  - prefix = "mod[#{new_or_existing}_book_attributes][]"
  = fields_for prefix, book do |book_form|
    %fieldset
      <span class = 'handle' style = #{new_or_existing == 'existing' ? "" : "display:none"}>#{image_tag("icons/move.png", :title => 'Drag and Drop', :alt => 'Drag and Drop', :border => 0)}
      <div id="new_book_#{book.id}" style = #{new_or_existing == 'new' ? "" : "display:none"} >
      %h5
        Edit Book
        \#{content_tag :a, image_tag("icons/remove.png", :alt => 'Remove', :border => 0), :onclick => "$(this).up('.book').remove()"}
      - if book and book.catalog_results.blank?
        %label{:for => "mod_label"}
          Book Title/Label
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(BOOK_TITLE_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = book_form.text_field :label
        %label{:for => "mod_label"}
          Book URL
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(BOOK_URL_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = book_form.text_field :url, :value => book.url || "http://"
      - else
        = text_area_tag '', book.catalog_results.collect{|r| r[:title]}.first, :disabled => true
        %p
          = book_form.radio_button :location, true
          Show Call Numbers  #{book_form.radio_button :location, false}Hide Call Numbers
      %label{:for => "mod_book_description"}
        Book Description
        %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(BOOK_DESC_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
      = book_form.text_area :description, {:class => 'tinymce', :size => '40x2'}
      = tinymce
      %label{:for => "mod_label"}
        Book ISBN/OCLC # (for book covers)
        %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(BOOK_ISBN_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
      = book_form.text_field :image_id
<div id="ex_book_#{book.id}" style = #{new_or_existing == 'existing' ? "" : "display:none"} >
%h5
  Book Preview
  \#{content_tag :a, "edit", :onclick => "$('ex_book_#{book.id}').toggle(); + $('new_book_#{book.id}').toggle();"}
  |
  \#{content_tag :a, image_tag("icons/remove.png", :title => 'Click to remove this book', :alt => 'Remove', :border => 0), :onclick => "$(this).up('.book').remove()"}
#book_view
  %p
    = render :partial => '/book/view_book', :locals => {:book => book}
