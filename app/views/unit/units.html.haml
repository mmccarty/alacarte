%fieldset
  %h3.title= render :partial => 'tutorial/title_actions'
  %h4 Units
  #share
    %fieldset
      %h4
        = link_to image_tag("icons/add.png", :title => 'Add Units', :alt => 'Add', :border => 0)+'Add Units', {:controller => 'unit', :action => 'add'}
      - unless @units.blank?
        %ul#full
          - @units.each do |uz|
          - unit = uz.unit
          - resources = unit.resourceables
            %li.list-item{:id => "item_#{uz.id}"}
              %span.list-title= truncate(h(unit.title) ,:length => 40)
              %span
                %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip('Slug Title: #{unit.slug} <br \/>Last Update: #{unit.updated_at.to_date} <br\/>Tagged with: <haml:silent> unit.tag_list.each do |tag|</haml:silent><haml:block> #{tag}</haml:block>', this, event, '125');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
                |
                \#{link_to image_tag("icons/edit.png", :title => 'Edit this Unit', :alt => 'Edit', :border => 0), { :controller =>'unit', :action => 'update', :id => unit}} |
                \#{link_to image_tag("icons/remove.png", :title => 'Remove this Unit from Tutorial', :alt => 'Delete', :border => 0), {:controller =>'unit', :action => 'remove_unit', :id => unit }, :confirm => 'Are you sure you want to remove this Unit from the Tutorial?', :method => :post}
                | #{link_to image_tag("icons/add.png", :title => 'Add Modules', :alt => 'Add', :border => 0)+'Add Modules', { :controller =>'unit', :action => 'add_modules', :id => unit}}
              %span.handle
                = image_tag("icons/move.png", :title => 'Drag and Drop', :alt => 'Drag and Drop', :border => 0)
              %div{:id => "detail_#{unit.id}", :style => "display:block"}
                = unit.description
                - unless resources.blank?
                  %ul.top_indent{:id => "full#{unit.id.to_s}"}
                    - resources.each do |resable|
                    - res = resable.resource
                    - mod = res.mod
                      %li.list-item{:id => "item_#{resable.id}"}
                        %span.list-title= truncate(h(mod.label) ,:length => 40)
                        %span.handle
                          = image_tag("icons/move.png", :title => 'Drag and Drop', :alt => 'Drag and Drop', :border => 0)
                        %br/
                        %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip('#{render_tooltip(mod)}', this, event, '125');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
                        |
                        \#{link_to image_tag("icons/edit.png", :title => 'Edit this module', :alt => 'Edit', :border => 0), { :controller =>'module', :action => 'edit_content', :id => mod, :type => mod.class}} |
                        \#{link_to image_tag("icons/document_preview.png", :title => 'View this Module', :alt => 'View Module', :border => 0),{ :controller => 'module', :action => 'view', :id => mod, :type => mod.class}, :popup => ['', 'height=500,width=400,toolbar=yes, scrollbars =yes,resizable=yes']} |
                        \#{link_to image_tag("icons/remove.png", :title => 'Delete this module from unit', :alt => 'Delete', :border => 0), {:controller => 'unit',:action => 'remove_module', :rid => res, :id => unit.id }, :confirm => 'Are you sure you want to remove this module from the lesson?', :method => :post}
                  = sortable_element 'full'+unit.id.to_s,                        |
                    :url => {:controller => 'unit', :action => "sort_mods" },    |
                    :complete => visual_effect(:highlight, 'full'+unit.id.to_s), |
                    :handle => 'handle',                                         |
                    :containment => ['full'+unit.id.to_s],                       |
                    :constraint => false                                         |
                - else
                  %p Unit does not have any modules.
                  %br/
              .top_space
                = link_to_function("Hide Details", nil, :id => 'full_link_'+unit.id.to_s) do |page| |
                  page.visual_effect(:toggle_blind,"detail_#{unit.id}")                             |
                  page << "if($('detail_#{unit.id}').visible()){"                                   |
                  page.replace_html 'full_link_'+unit.id.to_s, "Show Details"                       |
                  page << '}else{'                                                                  |
                  page.replace_html 'full_link_'+unit.id.to_s,  "Hide Details"                      |
                  page << '}'                                                                       |
                  end                                                                               |
        %span.clear
        = sortable_element 'full',                             |
          :url => {:controller => 'unit', :action => "sort" }, |
          :complete => visual_effect(:highlight, 'full'),      |
          :handle => 'handle',                                 |
          :containment => ['full'],                            |
          :constraint => false                                 |
      - else
        %p This tutorial does not have any units.
= render :partial => 'tutorial/side_bar'
