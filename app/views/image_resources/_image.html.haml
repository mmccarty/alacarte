.image
  = error_messages_for "image"
  - if flash[:error]
    #error_wrapper
      #list_error= flash[:error]
  - new_or_existing = image.new_record? ? 'new' : 'existing'
  - prefix = "mod[#{new_or_existing}_image_attributes][]"
  = fields_for prefix, image do |image_form|
    #images
      %fieldset
        <div id="new_image_#{image.id}" style = #{new_or_existing == 'new' ? "" : "display:none"} >
        %h5
          Edit Images
          \#{content_tag :a, image_tag("icons/remove.png", :alt => 'Remove', :border => 0), :onclick => "$(this).up('.image').remove()"}
        %label{:for => "mod_label"}
          Image Alternative Label
          %span.required.more_help *
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(IMAGE_ALT_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = image_form.text_field :alt
        %label{:for => "mod_label"}
          Image URL
          %span.required.more_help *
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(IMAGE_URL_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = image_form.text_field :url, :value => image.url || "http://"
        %label{:for => "mod_image_info"}
          Image Description
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(IMAGE_DESC_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = image_form.text_area :description, {:class => 'tinymce', :size => '40x2'}
        = tinymce
    <div id="ex_image_#{image.id}" style = #{new_or_existing == 'existing' ? "" : "display:none"} >
    %h5
      Image Preview
      \#{content_tag :a, "edit", :onclick => "$('ex_image_#{image.id}').toggle(); + $('new_image_#{image.id}').toggle();"}
      |
      \#{content_tag :a, image_tag("icons/remove.png", :title => 'Click to remove this image', :alt => 'Remove', :border => 0), :onclick => "$(this).up('.image').remove()"}
    %p
      %img.super_thumbnail{:alt => image.alt, :src => image.url}/
      - unless image.description.blank?
        %br/
        = image.description
