.uploadable
  - new_or_existing = uploadable.new_record? ? 'new' : 'existing'
  - prefix = "mod[#{new_or_existing}_uploadable_attributes][]"
  = fields_for prefix, uploadable do |uploadable_form|
    #upload
      %fieldset
        %h5
          Attachment
          \#{content_tag :a, image_tag("icons/remove.png", :alt => 'Remove', :border => 0), :onclick => "$(this).up('.uploadable').remove()"}
        <div id="new_upload_#{uploadable.id}" style = #{new_or_existing == 'new' ? "" : "display:none"} >
        %label{:for => "mod_upload"}
          Link Text and Upload
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(NEW_UPLOAD_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = uploadable_form.text_field :upload_link,"size" => 24
        = uploadable_form.file_field :upload,"size" => 24
        #inline_error
          = error_message_on :uploadable, :upload
        %label{:for => "mod_upload_info"}
          Attachment Information
          %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(UPLOAD_INFO_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
        = uploadable_form.text_area :upload_info, {:class => 'tinymce', :size => '40x2'}
        = tinymce
    <div id="ex_upload_#{uploadable.id}" style = #{new_or_existing == 'existing' ? "" : "display:none"} >
    %label{:for => "mod_upload"}
      Attachment Preview
      \#{content_tag :a, "edit", :onclick => "$('ex_upload_#{uploadable.id}').toggle(); + $('new_upload_#{uploadable.id}').toggle();"}
      |
      %span.more_help{:onmouseout => "delayhidetip();", :onmouseover => "fixedtooltip(UPLOAD_MSSG, this, event, '');"}= image_tag("icons/small_help.png", :alt => 'Tip', :border => 0)
      |
      \#{content_tag :a, image_tag("icons/remove.png", :title => 'Click to remove this attachment', :alt => 'Remove', :border => 0), :onclick => "$(this).up('.uploadable').remove()"}
    %a{:href => uploadable.upload.url()}= uploadable.upload_link.blank? ? h(uploadable.upload_file_name) : h(uploadable.upload_link)
    - unless uploadable.upload_info.blank?
      %br/
      = h(uploadable.upload_info)
