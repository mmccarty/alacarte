= javascript_include_tag 'template'
%h2= h @mod.module_title
.module
  = @mod.topic
  %div
    %a{:href => "#comment"} Leave a Comment
  = form_for :comment, :url => {:controller => :comment, :action => :create,  :resource_id => @mod.id} do |f|
    - if @mod.ordered_comments.size >= @mod.num_displayed
      %span#showing
        Showing
        %b
          = @mod.ordered_comments.size
          out of #{@mod.comments.count}
        Comments |
      %span{:id => "more_#{@mod.id}", :style => "display:none"}
        = render :partial => "comment/comments.html.erb", :locals => { |
          :comments => @mod.more_comments,                             |
          :num_characters => 200 }                                     |
      %noscript
        %span{:id => "more_#{@mod.id}"}
          = render :partial => "comment/comments.html.erb", :locals => { |
            :comments => @mod.more_comments,                             |
            :num_characters => 200 }                                     |
    %br/
    %div
      %a{:name => "comment"}>
      Only the Comment field is required. Your
      e-mail will not be shown; enter it if you wish to be contacted by the librarian.
    %div
      %label.contacts{:for => "comment_author_name"} Name
      = f.text_field :author_name, :value => flash[:author_name]
      = %(<br /><span class="required">#{flash[:author_name_error]}</span>) if flash[:author_name_error]
      %label.contacts{:for => "comment_author_email"} Email
      = f.text_field :author_email, :value => flash[:author_email]
      = %(<br /><span class="required">#{flash[:author_email_error]}</span>) if flash[:author_email_error]
      %label.contacts{:for => "comment_body"} Comment
      = f.text_area :body, :value => flash[:body], :size => "29x5"
      = %(<br /><span class="required">#{flash[:body_error]}</span>) if flash[:body_error]
      = recaptcha_tags(:display => {:theme => 'white'})
    %div= submit_tag "Post Comment"
