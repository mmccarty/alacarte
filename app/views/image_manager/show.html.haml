!!! Strict
%html{:xmlns => "http://www.w3.org/1999/xhtml"}
  %head
    %title Upload/insert/edit Image
    %meta{:content => "IE=8", "http-equiv" => "X-UA-Compatible"}/
    %script{:src => "/javascripts/prototype.js", :type => "text/javascript"}
    %script{:src => "/javascripts/effects.js", :type => "text/javascript"}
    %script{:src => "/javascripts/tiny_mce/tiny_mce_popup.js", :type => "text/javascript"}
    %script{:src => "/javascripts/tiny_mce/utils/form_utils.js", :type => "text/javascript"}
    %script{:src => "/javascripts/tiny_mce/plugins/advimage_uploader/js/image.js", :type => "text/javascript"}
    %link{:href => "css/advimage.css", :rel => "stylesheet", :type => "text/css"}/
    %base{:target => "_self"}/
    = js_to_be_included
  %body#advimage{:style => "display: none"}
    #msg_flash
      - flash.each do |key, msg|
        %div{:id => key}
          %p{:style => "float:right;"}= content_tag :a, 'X', :onclick => "Effect.Fade('#{key}')"
          %p= msg
          .clear
      - end
      - flash.clear
    #leftbox
      #dynamic_select_panel.panel.current
        #image_list
          = form_tag :html => {:id => "pic", :multipart => true },:url => {:action => 'add_path_to_general'},:update => "general_panel", :remote => true do
            = hidden_field_tag "pic_path", "", :id => "pic_path"
            = hidden_field_tag "norm_desc", "", :id => "norm_desc"
            = hidden_field_tag "norm_title", "", :id => "norm_title"
            - if @image_managers.length > 30
            - j=" style = \"height: 465px\";"
            - else
            - j=""
            - end
            <div id='dynamic_images_list'#{"#{j}"} >
            %fieldset
              %legend Available Images
              - i=1
              - @image_managers.each { |attr|
              - file = attr.photo.url + attr[:photo_file_name]
              - org_file = file.gsub(/thumb/,"original")
              - case i
              - when 1
                #first_image/
              - when 2
                #second_image/
              - when 3
                #third_image/
              - when 4
                #fourth_image/
              - else
                #fifth_image/
              = image_submit_tag file ,:id => 'thumb',:onclick => |
                "Change_Value('#{org_file}','pic_path');          |
                retrieve_values();"                               |
              %br/
              = link_to "Delete",  :confirm => 'Are you sure you want to delete this photo?',                                         |
                :url => { :controller => 'image_manager', :action => :destroy, :id => attr.id }, :method => :destroy, :remote => true |
        - if i >= 5
          %br/
          - i=1
          - else
          - i+=1
          - end
          - }
        #image-upload
          %fieldset
            %legend Upload New Image
            = form_for(:image,:url => {:action => 'create'}, |
              :html => {	:target=>"upframe",                 |
              :multipart => true,                            |
              :onsubmit => "disableUpload();" }) do |form|   |
              %br/
              = form.file_field('photo')
              %br/
              = submit_tag("Upload file",:id => 'upload_button')
      %iframe#upframe{:name => "upframe", :src => "about:blank"}
    %form#insert-form{:action => "#", :onsubmit => "ImageDialog.insert();return false;"}
      #rightbox
        #general_panel.panel
          %fieldset
            %legend General
            %table.properties
              %tr
                %td.column1
                  %label#srclabel{:for => "src"} Image URL / Path
                %td{:colspan => "2"}
                  %table{:border => "0", :cellpadding => "0", :cellspacing => "0"}
                    %tr
                      %td
                        %input#src.tinymce{:name => "src", :onchange => "ImageDialog.showPreviewImage(this.value);", :type => "text", :value => @path}/
                      %td#srcbrowsercontainer &nbsp;
                  = tinymce
              %tr
                %td.column1
                  %label#altlabel{:for => "alt"} Image Description
                %td{:colspan => "2"}
                  %input#alt{:name => "alt", :type => "text", :value => @desc}/
              %tr
                %td.column1
                  %label#titlelabel{:for => "title"} Title
                %td{:colspan => "2"}
                  %input#title{:name => "title", :type => "text", :value => @title}/
          %fieldset
            %legend Preview
            #prev
          :javascript
            ImageDialog.showPreviewImage("#{@path}"," ");
        #appearance_panel.panel
          %fieldset
            %legend Appearance
            %table{:border => "0", :cellpadding => "4", :cellspacing => "0"}
              %tr
                %td.column1
                  %label#alignlabel{:for => "align"} Alignment
                %td
                  %select#align{:name => "align", :onchange => "ImageDialog.updateStyle('align');ImageDialog.changeAppearance();"}
                    %option{:value => ""} -- not set --
                    %option{:value => "baseline"} Baseline
                    %option{:value => "top"} Top
                    %option{:value => "middle"} Middle
                    %option{:value => "bottom"} Bottom
                    %option{:value => "text-top"} Text top
                    %option{:value => "text-bottom"} Text bottom
                    %option{:value => "left"} Left
                    %option{:value => "right"} Right
              %tr
                %td.column1
                  %label#widthlabel{:for => "width"} Dimensions
                %td{:nowrap => "nowrap"}
                  %input#width.size{:maxlength => "5", :name => "width", :onchange => "ImageDialog.changeHeight();", :size => "5", :type => "text", :value => ""}/
                  x
                  %input#height.size{:maxlength => "5", :name => "height", :onchange => "ImageDialog.changeWidth();", :size => "5", :type => "text", :value => ""}/
                  px
              %tr
                %td &nbsp;
                %td
                  %table{:border => "0", :cellpadding => "0", :cellspacing => "0"}
                    %tr
                      %td
                        %input#constrain.checkbox{:name => "constrain", :type => "checkbox"}/
                      %td
                        %label#constrainlabel{:for => "constrain"} Constrain proportions
              %tr
                %td.column1
                  %label#vspacelabel{:for => "vspace"} Vertical space
                %td
                  %input#vspace.number{:maxlength => "3", :name => "vspace", :onblur => "ImageDialog.updateStyle('vspace');ImageDialog.changeAppearance();", :onchange => "ImageDialog.updateStyle('vspace');ImageDialog.changeAppearance();", :size => "3", :type => "text", :value => ""}/
              %tr
                %td.column1
                  %label#hspacelabel{:for => "hspace"} Horizontal space
                %td
                  %input#hspace.number{:maxlength => "3", :name => "hspace", :onblur => "ImageDialog.updateStyle('hspace');ImageDialog.changeAppearance();", :onchange => "ImageDialog.updateStyle('hspace');ImageDialog.changeAppearance();", :size => "3", :type => "text", :value => ""}/
              %tr
                %td.column1
                  %label#borderlabel{:for => "border"} Border
                %td
                  %input#border.number{:maxlength => "3", :name => "border", :onblur => "ImageDialog.updateStyle('border');ImageDialog.changeAppearance();", :onchange => "ImageDialog.updateStyle('border');ImageDialog.changeAppearance();", :size => "3", :type => "text", :value => ""}/
              %tr
                %td.column1
                  %label#stylelabel{:for => "style"} Style
                %td{:colspan => "2"}
                  %input#style{:name => "style", :onchange => "ImageDialog.changeAppearance();", :type => "text", :value => ""}/
        #rightbottom
          .mceActionPanel
            %div{:style => "float: left"}
              %input#insert{:name => "insert", :type => "submit", :value => "Insert"}/
            %div{:style => "float: right"}
              %input#cancel{:name => "cancel", :onclick => "tinyMCEPopup.close();", :type => "button", :value => "Cancel"}/
